import datetime
import chromadb
import traceback

from chromadb.utils import embedding_functions

from model_configurations import get_model_configuration

gpt_emb_version = 'text-embedding-ada-002'
gpt_emb_config = get_model_configuration(gpt_emb_version)

dbpath = "./"

from chromadb.utils import embedding_functions
from langchain_core.documents import Document
import datetime

def generate_hw01():
    # embedding function
    openai_ef = embedding_functions.OpenAIEmbeddingFunction(
                    api_base = gpt_emb_config['api_base'],
                    api_key = gpt_emb_config['api_key'],
                    api_type = gpt_emb_config['openai_type'],
                    api_version = gpt_emb_config['api_version'],
                    model_name = gpt_emb_config['deployment_name'],
                )

    chroma_client = chromadb.PersistentClient(dbpath) # store in local machine

    # create chroma
    collection = chroma_client.get_or_create_collection(
        name = "TRAVEL",
        metadata = {
            "hnsw:space": "cosine"
        },
        embedding_function = openai_ef
    )

    return collection

    
def generate_hw02(question, city, store_type, start_date, end_date):
    pass
    
def generate_hw03(question, store_name, new_store_name, city, store_type):
    pass
    
def demo(question):
    chroma_client = chromadb.PersistentClient(path=dbpath)
    openai_ef = embedding_functions.OpenAIEmbeddingFunction(
        api_key = gpt_emb_config['api_key'],
        api_base = gpt_emb_config['api_base'],
        api_type = gpt_emb_config['openai_type'],
        api_version = gpt_emb_config['api_version'],
        deployment_id = gpt_emb_config['deployment_name']
    )
    collection = chroma_client.get_or_create_collection(
        name="TRAVEL",
        metadata={"hnsw:space": "cosine"},
        embedding_function=openai_ef
    )
    
    return collection
